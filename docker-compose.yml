version: "3.9"

services:
    backend:
        build:
            context: .
            dockerfile: ./docker/Dockerfile
        restart: on-failure
        image: liam-ob/backend
        volumes:
            - backend:/backend
        ports:
            - "8000:8000"
        depends_on:
            - postgres
            - pgadmin
        env_file:
            - ./docker/.env

    postgres:
        image: postgres:13.3
        volumes:
            - postgres_data:/var/lib/postgresql/data/
        ports:
            - "5432:5432"
        expose:
            - "5432"
        env_file:
            - ./docker/.env

    pgadmin:
        image: dpage/pgadmin4
        volumes:
            - ./docker/pg_admin_db_setup.json:/pgadmin4/servers.json
        ports:
            - "5050:80"
        restart: unless-stopped
        depends_on:
            - postgres
        env_file:
            - ./docker/.env

volumes:
    postgres_data:
    backend:
        driver: local
        driver_opts:
            type: none
            device: ./backend/
            o: bind
